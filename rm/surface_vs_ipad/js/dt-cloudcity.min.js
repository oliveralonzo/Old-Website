"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}function asyncGeneratorStep(t,e,r,n,o,a,c){try{var i=t[a](c),s=i.value}catch(t){return void r(t)}i.done?e(s):Promise.resolve(s).then(n,o)}function _asyncToGenerator(i){return function(){var t=this,c=arguments;return new Promise(function(e,r){var n=i.apply(t,c);function o(t){asyncGeneratorStep(n,e,r,o,a,"next",t)}function a(t){asyncGeneratorStep(n,e,r,o,a,"throw",t)}o(void 0)})}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,r){return e&&_defineProperties(t.prototype,e),r&&_defineProperties(t,r),t}!function(g){var e=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],o=2<arguments.length?arguments[2]:void 0;var y=new(function(){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Logger";_classCallCheck(this,r),this.enabled=!1,this.prefix="".concat(t),this.green="#42efa7",this.orange="#ffbd5a",this.red="#ff6b6b";var e=/[\&|\?]cc_debug=([^&]+)/.exec(window.location.search);e&&e.length&&(this.enabled=!0)}return _createClass(r,[{key:"log",value:function(){var t;this.enabled&&(t=console).log.apply(t,["%c".concat(this.prefix),"background-color: ".concat(this.green,";")].concat(Array.prototype.slice.call(arguments)))}},{key:"warn",value:function(){var t;this.enabled&&(t=console).warn.apply(t,["%c".concat(this.prefix),"background-color: ".concat(this.orange,";")].concat(Array.prototype.slice.call(arguments)))}},{key:"error",value:function(){var t;this.enabled&&(t=console).error.apply(t,["%c".concat(this.prefix),"background-color: ".concat(this.red,";")].concat(Array.prototype.slice.call(arguments)))}}]),r}())("DTCC"),a=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"render",value:function(){throw new Error("Initialize DTCCAffiliateElement Render Method")}},{key:"getOfferUrl",value:function(t,e){var r,n,o=t.getUrl(),a=new URL(o),c=t.getMerchant().getNetworkName().toLowerCase().replace(/\s/,"-"),i=g.get("cc_tracking","dt:cc",{});if(i.hasOwnProperty(c)){var s=i[c];if(s.hasOwnProperty("params")){var l=s.params,u=Object.keys(l);0<u.length&&u.forEach(function(t){a.searchParams.set(t,l[t])})}if(s.hasOwnProperty("click_id")){var f=s.click_id,p=(r=(new Date).getTime(),n=Math.random().toString(36).substring(2,4)+Math.random().toString(36).substring(2,4),"".concat(r).concat(n));a.searchParams.append(f,p)}}if("amazon"===c){var d=e.trackingParam;d&&(y.log("Adding amzn tracking param ".concat(d," to"),o),a.has("tag")&&(a.delete("tag"),a.append("tag",d)))}return a.toString()}}]),t}(),t=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,a),_createClass(e,[{key:"render",value:function(t){var c=this;Array.isArray(t)||(t=[t]),t.forEach(function(t){var e=t.limit,r=t.product,n=r?r.getOffers():[];if(n.length){for(var o=0;o<n.length&&!(e-1<o);o++){var a=c.getOfferHTML(n[o],t);t.el.insertAdjacentHTML("beforebegin",a)}t.el.parentNode.removeChild(t.el)}else y.warn("No offers for placement",t)})}},{key:"getOfferHTML",value:function(t,e){var r=e.type,n=e.id,o=this.getOfferUrl(t,e),a=t.getMerchant(),c=a.getName()||"",i=a.getNetworkName().toLowerCase().replace(/\s/,"-"),s=t.getPrice(),l=e.cta&&e.cta.length?e.cta:"$".concat(s," from ").concat(c);return'\n\t\t\t<a id="dtcc-offer-'.concat(n,'" data-cloudcity-rendered data-cloudcity-network="').concat(i,'" target="_blank" rel="nofollow" href="').concat(o,'" class="dtcc-affiliate dtcc-affiliate--').concat(r,'" itemprop="offers" itemscope itemtype="http://schema.org/Offer">\n\t\t\t\t').concat(l,'\n\t\t\t\t<meta itemprop="url" content="').concat(o,'"/>\n\t\t\t\t<meta itemprop="priceCurrency" content="USD"/>\n\t\t\t\t<meta itemprop="price" content="').concat(s,'"/>\n\t\t\t\t<meta itemprop="seller" content="').concat(c,'"/>\n\t\t\t</a>')}}]),e}(),n=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,_getPrototypeOf(e).apply(this,arguments))}return _inherits(e,a),_createClass(e,[{key:"render",value:function(t){var o=this;Array.isArray(t)||(t=[t]),t.forEach(function(t){var e=t.product,r=e?e.getOffers():[];if(r.length){var n=o.getOfferHTML(r,t);t.el.insertAdjacentHTML("beforebegin",n),t.el.parentNode.removeChild(t.el)}else y.warn("CC: No offers for placement",t)})}},{key:"getOfferHTML",value:function(t,e){for(var r=e.id,n=e.limit,o=e.type,a=e.content,c=e.product,i=c.getImageUrl(),s=c.getName(),l="style='background:url(".concat(i,"); background-size: auto 100%; background-position: top; background-repeat: no-repeat;'"),u="",f=0;f<t.length&&!(n-1<f);f++){var p=t[f],d=this.getOfferUrl(p,e),g=p.getMerchant(),y=g.getName()||"",h=g.getNetworkName().toLowerCase().replace(/\s/,"-"),m=p.getPrice();u+='\n\t\t\t\t<a data-cloudcity-network="'.concat(h,'" href="').concat(d,'" target="_blank" class="offer-button" itemscope itemtype="http://schema.org/Offer">\n\t\t\t\t\t$').concat(m," from ").concat(y,'\n\t\t\t\t\t<meta itemprop="url" content="').concat(d,'"/>\n\t\t\t\t\t<meta itemprop="priceCurrency" content="USD"/>\n\t\t\t\t\t<meta itemprop="price" content="').concat(m,'"/>\n\t\t\t\t\t<meta itemprop="seller" content="').concat(y,'"/>\n\t\t\t\t</a>')}return'\n\t\t\t\t<div id="dtcc-'.concat(r,'" data-cloudcity-rendered class="dtcc-affiliate dtcc-affiliate--').concat(o,'">\n\t\t\t\t\t<div class="thumb" ').concat(l,'></div>\n\t\t\t\t\t<div class="content">\n\t\t\t\t\t\t<div class="title" itemprop="name">').concat(s,'</div>\n\t\t\t\t\t\t<div class="description" itemprop="description">').concat(a,'</div>\n\t\t\t\t\t\t<div class="offers" itemprop="offers">\n\t\t\t\t\t\t\t').concat(u,"\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t")}}]),e}();r.push(function(){window.DTCloudCity.registerPlacementType("widget",new n),window.DTCloudCity.registerPlacementType("button",new t),window.DTCloudCity.registerPlacementType("textlink",new t)});var s={},c=function(){function t(){_classCallCheck(this,t)}var e,r,n;return _createClass(t,[{key:"push",value:function(t){"function"==typeof t&&t()}},{key:"getProducts",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return window.CloudCity.getProducts(t)}},{key:"registerPlacementType",value:(n=_asyncToGenerator(regeneratorRuntime.mark(function t(e,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:s[e]=r,y.log("Registered custom placement type ".concat(e));case 2:case"end":return t.stop()}},t,this)})),function(t,e){return n.apply(this,arguments)})},{key:"getRendererForPlacementType",value:function(t){return s[t]||null}},{key:"getPagePlacements",value:(r=_asyncToGenerator(regeneratorRuntime.mark(function t(n){var o,e,r,a,c,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o="data-pid",e=_toConsumableArray(document.querySelectorAll("[data-cloudcity]")),y.log("Product on Page",e),r=e.filter(function(t){return t.hasAttribute(o)}).map(function(t){return t.getAttribute(o)}),t.next=6,this.getProducts({ids:r,targeting:n});case 6:return a=t.sent,c={},y.log("All products on page",a),i=e.map(function(e){var t=a.find(function(t){return(e.getAttribute(o)||"")===t.id}),r=e.getAttribute("data-type");return c.hasOwnProperty(r)?c[r]+=1:c[r]=0,{el:e,id:t?t.id:0,product:t,limit:e.getAttribute("data-limit")||1,cta:e.getAttribute("data-cta")||"",type:e.getAttribute("data-type")||"",placementId:"".concat(r,"-").concat(s[r]),trackingParam:e.getAttribute("data-amzn-tracking-param")||"",targeting:n,content:e.innerHTML}}),t.abrupt("return",i);case 11:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"renderPagePlacements",value:(e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var r,n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getPagePlacements(e);case 2:r=t.sent,y.log("All placements",r),r.forEach(function(t){y.log("Rendering ".concat(t.type),t);var e=n.getRendererForPlacementType(t.type);e?(y.log("Placement type ".concat(t.type," is registered")),e.render(t)):y.log("Placement type ".concat(t.type," is unregistered."))}),o.trigger("dtcc:placements-rendered");case 6:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"getBasePlacementRendererClass",value:function(){return a}}]),t}(),i=g.get("cc_opts","dt:cc",{});window.CloudCity.setApiConfig(i),window.CloudCity.push(function(){window.DTCloudCity=new c,r.forEach(function(t){return window.DTCloudCity.push(t.bind(e))});var t=g.get("cc_targeting","dt:cc",{});window.DTCloudCity.renderPagePlacements(t)})}(window.DTOptions,window.DTCloudCity,window.DTEvent);